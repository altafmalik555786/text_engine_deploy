{"ast":null,"code":"import _regeneratorRuntime from\"/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _createClass from\"/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _asyncToGenerator from\"/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{constRoute}from\"@utils/route\";import axios from\"axios\";import{camelCase,isArray,isObject,mapKeys,mapValues}from\"lodash\";import{notification}from\"../utils/notifications\";import{flushTokenFromCookies}from\"./common-utils\";var tokenSources={};function pushToLoginOrRegister(){flushTokenFromCookies();var nextUrl=window.location.pathname+window.location.search;var isJWT=window.location.search.includes(\"jwtToken=\");if(window.location.pathname!==constRoute.login&&!isJWT){localStorage.setItem(\"nextUrl\",nextUrl);}window.location.href=constRoute.login;}function onCancelRequest(_x){return _onCancelRequest.apply(this,arguments);}function _onCancelRequest(){_onCancelRequest=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(config){var _tokenSource,_key,tokenSource,_tokenSource2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:// if cancelToken is defined, we will cancel previous request and create a new token for new request.\nif(config.cancelToken){_key=config.url;tokenSource=tokenSources[_key!==null&&_key!==void 0?_key:0];if(tokenSource&&(_tokenSource=tokenSource)!==null&&_tokenSource!==void 0&&_tokenSource.cancel){(_tokenSource2=tokenSource)===null||_tokenSource2===void 0?void 0:_tokenSource2.cancel(\"Operation canceled due to new request\");}tokenSource=axios.CancelToken.source();config.cancelToken=tokenSource.token;tokenSources[_key!==null&&_key!==void 0?_key:0]=tokenSource;}return _context.abrupt(\"return\",config);case 2:case\"end\":return _context.stop();}},_callee);}));return _onCancelRequest.apply(this,arguments);}function onError(_x2,_x3,_x4){return _onError.apply(this,arguments);}function _onError(){_onError=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(error,axiosInstance,errorList){var throwError,response,status,data,errorItem;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:throwError=true;// return valid/empty response and exit\nif(!axios.isCancel(error)){_context2.next=4;break;}console.warn(error);return _context2.abrupt(\"return\",Promise.resolve({data:{isCancel:true}}));case 4:// Common error handling\nresponse=error.response;if(!response){notification.info(\"Something went wrong.\");}else if(response.status===401){// Interceptor that retries 401s by refreshing\n// tokens automatically only if token exists.\nnotification.info(\"Your session has expired. Please login again.\");pushToLoginOrRegister();}else{// Any other error.\nstatus=response.status,data=response.data;if(errorList&&errorList.length){errorItem=errorList.filter(function(err){return err.statusCode===status&&err.errorCode===data.code;}).pop();if(errorItem){throwError=false;notification.info(errorItem.message);}}}if(!throwError){_context2.next=8;break;}throw error;case 8:case\"end\":return _context2.stop();}},_callee2);}));return _onError.apply(this,arguments);}function keysToCamelCase(obj){if(isArray(obj)){// @ts-ignore\nreturn obj.map(keysToCamelCase);}if(!isObject(obj)){return obj;}var fixedKeys=mapKeys(obj,function(value,key){return camelCase(key);});// @ts-ignore\nreturn mapValues(fixedKeys,keysToCamelCase);}// tslint:disable-next-line:no-any\nfunction transformResponse(data){return keysToCamelCase(data);}function getDefaultTransformResponse(){var axiosDefault=axios.defaults.transformResponse;if(axiosDefault==null){return[transformResponse];}if(isArray(axiosDefault)){// @ts-ignore\nreturn axiosDefault===null||axiosDefault===void 0?void 0:axiosDefault.concat(transformResponse);}// @ts-ignore\nreturn[axiosDefault,transformResponse];}var CAMEL_CASE_DEFAULT_CONFIG={transformResponse:getDefaultTransformResponse()};export var BaseApi=/*#__PURE__*/_createClass(function BaseApi(baseURL,errorList){var _this=this;_classCallCheck(this,BaseApi);this.axios=void 0;this.axiosWithoutAuth=void 0;this.cancelToken=void 0;this.axios=axios.create(_objectSpread(_objectSpread({},CAMEL_CASE_DEFAULT_CONFIG),{},{baseURL:baseURL}));this.axios.interceptors.response.use(function(res){return res;},function(err){return onError(err,_this.axios,errorList);});this.axios.interceptors.request.use(onCancelRequest);this.axiosWithoutAuth=axios.create(_objectSpread(_objectSpread({},CAMEL_CASE_DEFAULT_CONFIG),{},{baseURL:baseURL}));this.cancelToken=axios.CancelToken.source().token;});","map":{"version":3,"names":["constRoute","axios","camelCase","isArray","isObject","mapKeys","mapValues","notification","flushTokenFromCookies","tokenSources","pushToLoginOrRegister","nextUrl","window","location","pathname","search","isJWT","includes","login","localStorage","setItem","href","onCancelRequest","_x","_onCancelRequest","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","config","_tokenSource","_key","tokenSource","_tokenSource2","wrap","_callee$","_context","prev","next","cancelToken","key","url","cancel","CancelToken","source","token","abrupt","stop","onError","_x2","_x3","_x4","_onError","_callee2","error","axiosInstance","errorList","throwError","response","status","data","errorItem","_callee2$","_context2","isCancel","console","warn","Promise","resolve","info","length","filter","err","statusCode","errorCode","code","pop","message","keysToCamelCase","obj","map","fixedKeys","value","transformResponse","getDefaultTransformResponse","axiosDefault","defaults","concat","CAMEL_CASE_DEFAULT_CONFIG","BaseApi","_createClass","baseURL","_this","_classCallCheck","axiosWithoutAuth","create","_objectSpread","interceptors","use","res","request"],"sources":["/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/src/api/baseApi.tsx"],"sourcesContent":["import { constRoute } from \"@utils/route\";\nimport axios, {\n  AxiosInstance,\n  AxiosRequestConfig,\n  AxiosError,\n  CancelTokenSource,\n  CancelToken,\n} from \"axios\";\nimport { camelCase, isArray, isObject, mapKeys, mapValues } from \"lodash\";\nimport { notification } from \"../utils/notifications\";\nimport { flushTokenFromCookies } from \"./common-utils\";\n\nconst tokenSources: {\n  [key: string]: CancelTokenSource;\n} = {};\n\nexport type ApiErrorType = {\n  statusCode: number;\n  errorCode: string;\n  message: string;\n};\n\nfunction pushToLoginOrRegister() {\n  flushTokenFromCookies();\n  const nextUrl = window.location.pathname + window.location.search;\n  const isJWT = window.location.search.includes(\"jwtToken=\");\n  if (\n    window.location.pathname !== constRoute.login &&\n    !isJWT\n  ) {\n    localStorage.setItem(\"nextUrl\", nextUrl);\n  }\n  window.location.href = constRoute.login;\n}\n\nasync function onCancelRequest(config) {\n  // if cancelToken is defined, we will cancel previous request and create a new token for new request.\n  if (config.cancelToken) {\n    const key = config.url;\n    let tokenSource = tokenSources[key ?? 0];\n    if (tokenSource && tokenSource?.cancel) {\n      tokenSource?.cancel(\"Operation canceled due to new request\");\n    }\n    tokenSource = axios.CancelToken.source();\n    config.cancelToken = tokenSource.token;\n    tokenSources[key ?? 0] = tokenSource;\n  }\n\n  return config;\n}\n\nasync function onError(\n  error: AxiosError,\n  axiosInstance: AxiosInstance,\n  errorList?: ApiErrorType[]\n) {\n  let throwError = true;\n  // return valid/empty response and exit\n  if (axios.isCancel(error)) {\n    console.warn(error);\n    return Promise.resolve({ data: { isCancel: true } });\n  }\n  // Common error handling\n  const { response }: any = error;\n  if (!response) {\n    notification.info(\"Something went wrong.\");\n  } else if (response.status === 401) {\n    // Interceptor that retries 401s by refreshing\n    // tokens automatically only if token exists.\n    notification.info(\"Your session has expired. Please login again.\");\n    pushToLoginOrRegister();\n  } else {\n    // Any other error.\n    const { status, data }: any = response;\n    if (errorList && errorList.length) {\n      const errorItem = errorList\n        .filter(\n          (err) => err.statusCode === status && err.errorCode === data.code\n        )\n        .pop();\n      if (errorItem) {\n        throwError = false;\n        notification.info(errorItem.message);\n      }\n    }\n  }\n  if (throwError) {\n    throw error;\n  }\n}\n\nfunction keysToCamelCase<T>(obj: T): T {\n  if (isArray(obj)) {\n    // @ts-ignore\n    return obj.map(keysToCamelCase);\n  }\n  if (!isObject(obj)) {\n    return obj;\n  }\n  const fixedKeys = mapKeys(obj, (value, key) => camelCase(key));\n  // @ts-ignore\n  return mapValues(fixedKeys, keysToCamelCase);\n}\n\n// tslint:disable-next-line:no-any\nfunction transformResponse(data: any): any {\n  return keysToCamelCase(data);\n}\n\nfunction getDefaultTransformResponse(): any[] {\n  const axiosDefault = axios.defaults.transformResponse;\n  if (axiosDefault == null) {\n    return [transformResponse];\n  }\n  if (isArray(axiosDefault)) {\n    // @ts-ignore\n    return axiosDefault?.concat(transformResponse);\n  }\n  // @ts-ignore\n  return [axiosDefault, transformResponse];\n}\n\nconst CAMEL_CASE_DEFAULT_CONFIG: AxiosRequestConfig = {\n  transformResponse: getDefaultTransformResponse(),\n};\n\nexport class BaseApi {\n  axios: AxiosInstance;\n  axiosWithoutAuth: AxiosInstance;\n  cancelToken: CancelToken;\n\n  constructor(baseURL?: string, errorList?: ApiErrorType[]) {\n    this.axios = axios.create({ ...CAMEL_CASE_DEFAULT_CONFIG, baseURL });\n    this.axios.interceptors.response.use(\n      (res) => res,\n      (err) => onError(err, this.axios, errorList)\n    );\n    this.axios.interceptors.request.use(onCancelRequest);\n    this.axiosWithoutAuth = axios.create({\n      ...CAMEL_CASE_DEFAULT_CONFIG,\n      baseURL,\n    });\n    this.cancelToken = axios.CancelToken.source().token;\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}