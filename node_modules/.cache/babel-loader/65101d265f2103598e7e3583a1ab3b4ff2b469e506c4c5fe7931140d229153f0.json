{"ast":null,"code":"import _regeneratorRuntime from\"/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import{flow,types}from\"mobx-state-tree\";import{userApi}from\"../../api\";import{notification}from\"../../utils/notifications\";import{constRoute}from\"@utils/route\";import{catchError,onLogOutClearAll}from\"@utils/common-functions\";import{currentUserModel,userInfoModel}from\"@stores/store-utils\";import{toJS}from\"mobx\";import{JWT_AUTH_ACCESS_TOKEN}from\"@utils/constants/important\";export var user=types.model({userInfo:types.maybeNull(userInfoModel),loading:types.optional(types.boolean,false),loadingLogin:types.optional(types.boolean,false),loadingCurrentUser:types.optional(types.boolean,false),currentUserData:types.maybeNull(currentUserModel)}).views(function(self){return{get getUserInfo(){return toJS(self.userInfo);},get isLoadingLogin(){return toJS(self.loadingLogin);},get getCurrentUserData(){return toJS(self.currentUserData);}};}).actions(function(self){var onUserLogin=flow(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(data,navigate){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:self.loadingLogin=true;_context.prev=1;_context.next=4;return userApi.onUserLogin(data);case 4:res=_context.sent;localStorage.setItem(JWT_AUTH_ACCESS_TOKEN,res===null||res===void 0?void 0:res.jwt_token);if(res!==null&&res!==void 0&&res.jwt_token){loadUserInfo().then(function(data){var _data$data,_data$data$error,_data$data2,_data$data2$error;if(data!==null&&data!==void 0&&(_data$data=data.data)!==null&&_data$data!==void 0&&(_data$data$error=_data$data.error)!==null&&_data$data$error!==void 0&&_data$data$error.includes('Invalid token')||data!==null&&data!==void 0&&(_data$data2=data.data)!==null&&_data$data2!==void 0&&(_data$data2$error=_data$data2.error)!==null&&_data$data2$error!==void 0&&_data$data2$error.includes('Token has expired')){catchError(data,\"loadUserInfo\");navigate(\"\".concat(constRoute.login));}else{notification.success(\"Signed in successfully\");navigate(\"\".concat(constRoute.home));}});}_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);catchError(_context.t0,\"onUserLogin\");case 12:_context.prev=12;self.loadingLogin=false;return _context.finish(12);case 15:case\"end\":return _context.stop();}},_callee,null,[[1,9,12,15]]);}));var loadUserInfo=flow(function(){var navigate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var response,res,_error$response,_error$response$data,_error$response$data$,_error$response2,_error$response2$data,_error$response2$data2;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:self.loadingCurrentUser=true;response=null;_context2.prev=2;self.loadingCurrentUser=true;_context2.next=6;return userApi.getCurrentUserDetails();case 6:res=_context2.sent;response=res;self.currentUserData=res;_context2.next=16;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](2);catchError(_context2.t0,\"loadUserInfo\");response=_context2.t0.response;if(_context2.t0!==null&&_context2.t0!==void 0&&(_error$response=_context2.t0.response)!==null&&_error$response!==void 0&&(_error$response$data=_error$response.data)!==null&&_error$response$data!==void 0&&(_error$response$data$=_error$response$data.error)!==null&&_error$response$data$!==void 0&&_error$response$data$.includes('Invalid token')||_context2.t0!==null&&_context2.t0!==void 0&&(_error$response2=_context2.t0.response)!==null&&_error$response2!==void 0&&(_error$response2$data=_error$response2.data)!==null&&_error$response2$data!==void 0&&(_error$response2$data2=_error$response2$data.error)!==null&&_error$response2$data2!==void 0&&_error$response2$data2.includes('Token has expired')){onLogOutClearAll(navigate);}case 16:_context2.prev=16;self.loadingCurrentUser=false;return _context2.abrupt(\"return\",response);case 20:case\"end\":return _context2.stop();}},_callee2,null,[[2,11,16,20]]);})();});return{onUserLogin:onUserLogin,loadUserInfo:loadUserInfo};});export function initUser(){return user.create({});}","map":{"version":3,"names":["flow","types","userApi","notification","constRoute","catchError","onLogOutClearAll","currentUserModel","userInfoModel","toJS","JWT_AUTH_ACCESS_TOKEN","user","model","userInfo","maybeNull","loading","optional","boolean","loadingLogin","loadingCurrentUser","currentUserData","views","self","getUserInfo","isLoadingLogin","getCurrentUserData","actions","onUserLogin","_regeneratorRuntime","mark","_callee","data","navigate","res","wrap","_callee$","_context","prev","next","sent","localStorage","setItem","jwt_token","loadUserInfo","then","_data$data","_data$data$error","_data$data2","_data$data2$error","error","includes","concat","login","success","home","t0","finish","stop","arguments","length","undefined","_callee2","response","_error$response","_error$response$data","_error$response$data$","_error$response2","_error$response2$data","_error$response2$data2","_callee2$","_context2","getCurrentUserDetails","abrupt","initUser","create"],"sources":["/Users/altafmalik/ReactJS/Obed Bhai/Tax_Engine_Test/src/stores/user/user.tsx"],"sourcesContent":["import { flow, types } from \"mobx-state-tree\";\nimport { userApi } from \"../../api\";\nimport { notification } from \"../../utils/notifications\";\nimport { constRoute } from \"@utils/route\";\nimport { catchError, onLogOutClearAll } from \"@utils/common-functions\";\nimport {\n  currentUserModel,\n  userInfoModel,\n} from \"@stores/store-utils\";\nimport { toJS } from \"mobx\";\nimport { JWT_AUTH_ACCESS_TOKEN } from \"@utils/constants/important\";\nexport const user = types\n\n  .model({\n    userInfo: types.maybeNull(userInfoModel),\n    loading: types.optional(types.boolean, false),    \n    loadingLogin: types.optional(types.boolean, false),    \n    loadingCurrentUser: types.optional(types.boolean, false), \n    currentUserData: types.maybeNull(currentUserModel),\n  })\n  .views((self) => ({\n    get getUserInfo() {\n      return toJS(self.userInfo);\n    },\n    get isLoadingLogin() {\n      return toJS(self.loadingLogin);\n    },\n    get getCurrentUserData(){\n      return toJS(self.currentUserData)\n    },\n  }))\n  .actions((self) => {\n    const onUserLogin = flow(function* (data, navigate) {\n      self.loadingLogin = true;\n      try {\n        const res = yield userApi.onUserLogin(data);\n          localStorage.setItem(JWT_AUTH_ACCESS_TOKEN, res?.jwt_token);\n          if(res?.jwt_token){\n           loadUserInfo().then((data) => {\n            if(data?.data?.error?.includes('Invalid token') || data?.data?.error?.includes('Token has expired')){\n              catchError(data, \"loadUserInfo\");  \n              navigate(`${constRoute.login}`);\n            } else{\n              notification.success(\"Signed in successfully\");\n              navigate(`${constRoute.home}`);\n            }\n          });\n         \n      }\n      } catch (error) {\n        catchError(error, \"onUserLogin\");\n      } finally {\n        self.loadingLogin = false;\n      }\n    });\n\n    const loadUserInfo = flow(function* (navigate = null) {\n      self.loadingCurrentUser = true;\n      let response = null;\n      try {\n        self.loadingCurrentUser = true;\n        const res = yield userApi.getCurrentUserDetails();\n        response = res;\n        self.currentUserData = res;\n      } catch (error) {\n        catchError(error, \"loadUserInfo\");\n        response = error.response;\n        if (error?.response?.data?.error?.includes('Invalid token') || error?.response?.data?.error?.includes('Token has expired')) {\n          onLogOutClearAll(navigate);\n        }\n      } finally {\n        self.loadingCurrentUser = false;\n        return response;\n      }\n    });\n   \n    return {\n      onUserLogin,\n      loadUserInfo,\n    };\n  });\n\nexport function initUser() {\n  return user.create({});\n}\n"],"mappings":"mJAAA,OAASA,IAAI,CAAEC,KAAK,KAAQ,iBAAiB,CAC7C,OAASC,OAAO,KAAQ,WAAW,CACnC,OAASC,YAAY,KAAQ,2BAA2B,CACxD,OAASC,UAAU,KAAQ,cAAc,CACzC,OAASC,UAAU,CAAEC,gBAAgB,KAAQ,yBAAyB,CACtE,OACEC,gBAAgB,CAChBC,aAAa,KACR,qBAAqB,CAC5B,OAASC,IAAI,KAAQ,MAAM,CAC3B,OAASC,qBAAqB,KAAQ,4BAA4B,CAClE,MAAO,IAAM,CAAAC,IAAI,CAAGV,KAAK,CAEtBW,KAAK,CAAC,CACLC,QAAQ,CAAEZ,KAAK,CAACa,SAAS,CAACN,aAAa,CAAC,CACxCO,OAAO,CAAEd,KAAK,CAACe,QAAQ,CAACf,KAAK,CAACgB,OAAO,CAAE,KAAK,CAAC,CAC7CC,YAAY,CAAEjB,KAAK,CAACe,QAAQ,CAACf,KAAK,CAACgB,OAAO,CAAE,KAAK,CAAC,CAClDE,kBAAkB,CAAElB,KAAK,CAACe,QAAQ,CAACf,KAAK,CAACgB,OAAO,CAAE,KAAK,CAAC,CACxDG,eAAe,CAAEnB,KAAK,CAACa,SAAS,CAACP,gBAAgB,CACnD,CAAC,CAAC,CACDc,KAAK,CAAC,SAACC,IAAI,QAAM,CAChB,GAAI,CAAAC,WAAWA,CAAA,CAAG,CAChB,MAAO,CAAAd,IAAI,CAACa,IAAI,CAACT,QAAQ,CAAC,CAC5B,CAAC,CACD,GAAI,CAAAW,cAAcA,CAAA,CAAG,CACnB,MAAO,CAAAf,IAAI,CAACa,IAAI,CAACJ,YAAY,CAAC,CAChC,CAAC,CACD,GAAI,CAAAO,kBAAkBA,CAAA,CAAE,CACtB,MAAO,CAAAhB,IAAI,CAACa,IAAI,CAACF,eAAe,CAAC,CACnC,CACF,CAAC,EAAC,CAAC,CACFM,OAAO,CAAC,SAACJ,IAAI,CAAK,CACjB,GAAM,CAAAK,WAAW,CAAG3B,IAAI,cAAA4B,mBAAA,GAAAC,IAAA,CAAC,SAAAC,QAAWC,IAAI,CAAEC,QAAQ,MAAAC,GAAA,QAAAL,mBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAChDhB,IAAI,CAACJ,YAAY,CAAG,IAAI,CAACkB,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,GAEX,MAAM,CAAApC,OAAO,CAACyB,WAAW,CAACI,IAAI,CAAC,QAArCE,GAAG,CAAAG,QAAA,CAAAG,IAAA,CACPC,YAAY,CAACC,OAAO,CAAC/B,qBAAqB,CAAEuB,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAES,SAAS,CAAC,CAC3D,GAAGT,GAAG,SAAHA,GAAG,WAAHA,GAAG,CAAES,SAAS,CAAC,CACjBC,YAAY,EAAE,CAACC,IAAI,CAAC,SAACb,IAAI,CAAK,KAAAc,UAAA,CAAAC,gBAAA,CAAAC,WAAA,CAAAC,iBAAA,CAC7B,GAAGjB,IAAI,SAAJA,IAAI,YAAAc,UAAA,CAAJd,IAAI,CAAEA,IAAI,UAAAc,UAAA,YAAAC,gBAAA,CAAVD,UAAA,CAAYI,KAAK,UAAAH,gBAAA,WAAjBA,gBAAA,CAAmBI,QAAQ,CAAC,eAAe,CAAC,EAAInB,IAAI,SAAJA,IAAI,YAAAgB,WAAA,CAAJhB,IAAI,CAAEA,IAAI,UAAAgB,WAAA,YAAAC,iBAAA,CAAVD,WAAA,CAAYE,KAAK,UAAAD,iBAAA,WAAjBA,iBAAA,CAAmBE,QAAQ,CAAC,mBAAmB,CAAC,CAAC,CAClG7C,UAAU,CAAC0B,IAAI,CAAE,cAAc,CAAC,CAChCC,QAAQ,IAAAmB,MAAA,CAAI/C,UAAU,CAACgD,KAAK,EAAG,CACjC,CAAC,IAAK,CACJjD,YAAY,CAACkD,OAAO,CAAC,wBAAwB,CAAC,CAC9CrB,QAAQ,IAAAmB,MAAA,CAAI/C,UAAU,CAACkD,IAAI,EAAG,CAChC,CACF,CAAC,CAAC,CAEN,CAAClB,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAmB,EAAA,CAAAnB,QAAA,aAEC/B,UAAU,CAAA+B,QAAA,CAAAmB,EAAA,CAAQ,aAAa,CAAC,CAAC,QAAAnB,QAAA,CAAAC,IAAA,IAEjCf,IAAI,CAACJ,YAAY,CAAG,KAAK,CAAC,OAAAkB,QAAA,CAAAoB,MAAA,8BAAApB,QAAA,CAAAqB,IAAA,MAAA3B,OAAA,sBAE7B,EAAC,CAEF,GAAM,CAAAa,YAAY,CAAG3C,IAAI,CAAC,cAAW,CAAAgC,QAAQ,CAAA0B,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,oBAAA9B,mBAAA,GAAAC,IAAA,UAAAgC,SAAA,MAAAC,QAAA,CAAA7B,GAAA,CAAA8B,eAAA,CAAAC,oBAAA,CAAAC,qBAAA,CAAAC,gBAAA,CAAAC,qBAAA,CAAAC,sBAAA,QAAAxC,mBAAA,GAAAM,IAAA,UAAAmC,UAAAC,SAAA,iBAAAA,SAAA,CAAAjC,IAAA,CAAAiC,SAAA,CAAAhC,IAAA,SAClDhB,IAAI,CAACH,kBAAkB,CAAG,IAAI,CAC1B2C,QAAQ,CAAG,IAAI,CAAAQ,SAAA,CAAAjC,IAAA,GAEjBf,IAAI,CAACH,kBAAkB,CAAG,IAAI,CAACmD,SAAA,CAAAhC,IAAA,GACnB,MAAM,CAAApC,OAAO,CAACqE,qBAAqB,EAAE,QAA3CtC,GAAG,CAAAqC,SAAA,CAAA/B,IAAA,CACTuB,QAAQ,CAAG7B,GAAG,CACdX,IAAI,CAACF,eAAe,CAAGa,GAAG,CAACqC,SAAA,CAAAhC,IAAA,kBAAAgC,SAAA,CAAAjC,IAAA,IAAAiC,SAAA,CAAAf,EAAA,CAAAe,SAAA,aAE3BjE,UAAU,CAAAiE,SAAA,CAAAf,EAAA,CAAQ,cAAc,CAAC,CACjCO,QAAQ,CAAGQ,SAAA,CAAAf,EAAA,CAAMO,QAAQ,CACzB,GAAIQ,SAAA,CAAAf,EAAA,SAAAe,SAAA,CAAAf,EAAA,YAAAQ,eAAA,CAAAO,SAAA,CAAAf,EAAA,CAAOO,QAAQ,UAAAC,eAAA,YAAAC,oBAAA,CAAfD,eAAA,CAAiBhC,IAAI,UAAAiC,oBAAA,YAAAC,qBAAA,CAArBD,oBAAA,CAAuBf,KAAK,UAAAgB,qBAAA,WAA5BA,qBAAA,CAA8Bf,QAAQ,CAAC,eAAe,CAAC,EAAAoB,SAAA,CAAAf,EAAA,SAAAe,SAAA,CAAAf,EAAA,YAAAW,gBAAA,CAAII,SAAA,CAAAf,EAAA,CAAOO,QAAQ,UAAAI,gBAAA,YAAAC,qBAAA,CAAfD,gBAAA,CAAiBnC,IAAI,UAAAoC,qBAAA,YAAAC,sBAAA,CAArBD,qBAAA,CAAuBlB,KAAK,UAAAmB,sBAAA,WAA5BA,sBAAA,CAA8BlB,QAAQ,CAAC,mBAAmB,CAAC,CAAE,CAC1H5C,gBAAgB,CAAC0B,QAAQ,CAAC,CAC5B,CAAC,QAAAsC,SAAA,CAAAjC,IAAA,IAEDf,IAAI,CAACH,kBAAkB,CAAG,KAAK,CAAC,OAAAmD,SAAA,CAAAE,MAAA,UACzBV,QAAQ,2BAAAQ,SAAA,CAAAb,IAAA,MAAAI,QAAA,4BAElB,CAAC,CAEF,MAAO,CACLlC,WAAW,CAAXA,WAAW,CACXgB,YAAY,CAAZA,YACF,CAAC,CACH,CAAC,CAAC,CAEJ,MAAO,SAAS,CAAA8B,QAAQA,CAAA,CAAG,CACzB,MAAO,CAAA9D,IAAI,CAAC+D,MAAM,CAAC,CAAC,CAAC,CAAC,CACxB"},"metadata":{},"sourceType":"module","externalDependencies":[]}